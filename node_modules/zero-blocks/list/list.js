"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var core_1 = require('@angular/core');
var common_1 = require("@angular/common");
// ====================== LIST ================================
// The `<ig-list>` directive is a list container for items and headers 
var List = (function () {
    function List(element) {
        this.element = element;
        this._innerStyle = "ig-list";
        this.children = [];
    }
    Object.defineProperty(List.prototype, "items", {
        get: function () {
            return this.children.filter(function (item) {
                return item instanceof ListItem;
            });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "headers", {
        get: function () {
            return this.children.filter(function (header) {
                return header instanceof ListHeader;
            });
        },
        enumerable: true,
        configurable: true
    });
    List.prototype.removeChild = function (index) {
        this.children.splice(index, 1);
    };
    List.prototype.addChild = function (child) {
        this.children.push(child);
    };
    List = __decorate([
        core_1.Component({
            selector: 'ig-list',
            moduleId: module.id,
            template: "\n      <div #wrapper class=\"{{_innerStyle}}\" [hidden]=\"hidden\">\n        <ng-content></ng-content>\n      </div>\n      <!--<div *ngIf=\"options\" class=\"options\">\n          <button class=\"btn btn-success\"> OK </button>\n          <button class=\"btn btn-danger\"> Cancel </button>\n          <button class=\"btn btn-info\"> More info </button>\n      </div>-->\n    "
        }), 
        __metadata('design:paramtypes', [core_1.ElementRef])
    ], List);
    return List;
}());
exports.List = List;
// ====================== HEADER ================================
// The `<ig-header>` directive is a header intended for row items in
// a `<ig-list>` container.
var ListHeader = (function () {
    function ListHeader(list, element) {
        this.list = list;
        this.element = element;
        this._innerStyle = "ig-list__header";
    }
    Object.defineProperty(ListHeader.prototype, "index", {
        get: function () {
            return this.list.children.indexOf(this);
        },
        enumerable: true,
        configurable: true
    });
    ListHeader.prototype.ngOnInit = function () {
        this.list.addChild(this);
    };
    ListHeader = __decorate([
        core_1.Component({
            selector: 'ig-list-header',
            moduleId: module.id,
            template: "\n      <div #wrapper class=\"{{_innerStyle}}\" [hidden]=\"hidden\">\n        <ng-content></ng-content>\n      </div>\n      <!--<div *ngIf=\"options\" class=\"options\">\n          <button class=\"btn btn-success\"> OK </button>\n          <button class=\"btn btn-danger\"> Cancel </button>\n          <button class=\"btn btn-info\"> More info </button>\n      </div>-->\n    "
        }),
        __param(0, core_1.Inject(core_1.forwardRef(function () { return List; }))), 
        __metadata('design:paramtypes', [List, core_1.ElementRef])
    ], ListHeader);
    return ListHeader;
}());
exports.ListHeader = ListHeader;
// ====================== ITEM ================================
// The `<ig-item>` directive is a container intended for row items in
// a `<ig-list>` container.
var ListItem = (function () {
    function ListItem(list, element, _renderer) {
        this.list = list;
        this.element = element;
        this._renderer = _renderer;
        this._VISIBLE_AREA_ON_FULL_PAN = 40; // in pixels
        this._FRACTION_OF_WIDTH_TO_TRIGGER_GRIP = 0.5; // as a fraction of the item width
        this._initialLeft = null;
        this._innerStyle = "ig-list__item";
        this.hidden = false;
    }
    Object.defineProperty(ListItem.prototype, "index", {
        get: function () {
            return this.list.children.indexOf(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ListItem.prototype, "width", {
        get: function () {
            if (this.element && this.element.nativeElement) {
                return this.element.nativeElement.offsetWidth;
            }
            else {
                return 0;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ListItem.prototype, "left", {
        get: function () {
            return this.wrapper.nativeElement.offsetLeft;
        },
        set: function (value) {
            var val = value + "";
            if (val.indexOf("px") == -1) {
                val += "px";
            }
            this.wrapper.nativeElement.style.left = val;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ListItem.prototype, "maxLeft", {
        get: function () {
            return -this.width + this._VISIBLE_AREA_ON_FULL_PAN;
        },
        enumerable: true,
        configurable: true
    });
    ListItem.prototype.ngOnInit = function () {
        this.list.addChild(this);
        this._addEventListeners();
        // Fix for default value of touch-action: none, set by Hammer.js
        this.element.nativeElement.style.touchAction = "inherit";
    };
    ListItem.prototype.ngOnDestroy = function () {
        this.list.removeChild(this.index);
    };
    ListItem.prototype._addEventListeners = function () {
        var _this = this;
        // Do not attach pan events if there is no options - no need to pan the item
        if (this._renderer && this.options) {
            this._renderer.listen(this.element.nativeElement, 'panstart', function (event) { _this.panStart(event); });
            this._renderer.listen(this.element.nativeElement, 'panmove', function (event) { _this.panMove(event); });
            this._renderer.listen(this.element.nativeElement, 'panend', function (event) { _this.panEnd(event); });
        }
    };
    ListItem.prototype.cancelEvent = function (ev) {
        return this.left > 0 || this._initialLeft == null;
    };
    ListItem.prototype.panStart = function (ev) {
        this._initialLeft = this.left;
    };
    ListItem.prototype.panMove = function (ev) {
        var newLeft;
        if (this.cancelEvent(ev)) {
            return;
        }
        newLeft = this._initialLeft + ev.deltaX;
        newLeft = newLeft > 0 ? 0 : newLeft < this.maxLeft ? this.maxLeft : newLeft;
        this.left = newLeft;
    };
    ListItem.prototype.panEnd = function (ev) {
        if (this.left > 0) {
            this.rightMagneticGrip();
        }
        else {
            this.magneticGrip();
        }
        this._initialLeft = null;
    };
    ListItem.prototype.magneticGrip = function () {
        var left = this.left, partialWidth = this.width * this._FRACTION_OF_WIDTH_TO_TRIGGER_GRIP;
        if (partialWidth && left < 0 && -left > partialWidth) {
            this.leftMagneticGrip();
        }
        else {
            this.rightMagneticGrip();
        }
    };
    ListItem.prototype.rightMagneticGrip = function () {
        this.left = 0;
    };
    ListItem.prototype.leftMagneticGrip = function () {
        this.left = this.maxLeft;
    };
    __decorate([
        core_1.ViewChild('wrapper'), 
        __metadata('design:type', core_1.ElementRef)
    ], ListItem.prototype, "wrapper", void 0);
    __decorate([
        core_1.Input(), 
        __metadata('design:type', String)
    ], ListItem.prototype, "href", void 0);
    __decorate([
        core_1.Input(), 
        __metadata('design:type', Array)
    ], ListItem.prototype, "options", void 0);
    ListItem = __decorate([
        core_1.Component({
            selector: 'ig-list-item',
            moduleId: module.id,
            template: "\n      <div #wrapper class=\"{{_innerStyle}}\" [hidden]=\"hidden\">\n        <ng-content></ng-content>\n      </div>\n      <!--<div *ngIf=\"options\" class=\"options\">\n          <button class=\"btn btn-success\"> OK </button>\n          <button class=\"btn btn-danger\"> Cancel </button>\n          <button class=\"btn btn-info\"> More info </button>\n      </div>-->\n    "
        }),
        __param(0, core_1.Inject(core_1.forwardRef(function () { return List; }))), 
        __metadata('design:paramtypes', [List, core_1.ElementRef, core_1.Renderer])
    ], ListItem);
    return ListItem;
}());
exports.ListItem = ListItem;
var ListModule = (function () {
    function ListModule() {
    }
    ListModule = __decorate([
        core_1.NgModule({
            declarations: [List, ListItem, ListHeader],
            imports: [common_1.CommonModule],
            exports: [List, ListItem, ListHeader]
        }), 
        __metadata('design:paramtypes', [])
    ], ListModule);
    return ListModule;
}());
exports.ListModule = ListModule;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QWdCLEVBQUUsQ0FBQztRQUM1QixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDSixJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUM3QixDQUFDO0lBQ0wsQ0FBQztJQUVPLG9DQUFpQixHQUF6QjtRQUNJLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO0lBQ2xCLENBQUM7SUFFTyxtQ0FBZ0IsR0FBeEI7UUFDSSxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDN0IsQ0FBQztJQWpIRDtRQUFDLGdCQUFTLENBQUMsU0FBUyxDQUFDOzs2Q0FBQTtJQXFDckI7UUFBQyxZQUFLLEVBQUU7OzBDQUFBO0lBQ1I7UUFBQyxZQUFLLEVBQUU7OzZDQUFBO0lBdERaO1FBQUMsZ0JBQVMsQ0FBQztZQUNQLFFBQVEsRUFBRSxjQUFjO1lBQ3hCLFFBQVEsRUFBRSxNQUFNLENBQUMsRUFBRTtZQUNuQixRQUFRLEVBQUUsMlhBU1Q7U0FDSixDQUFDO21CQTJDZ0IsYUFBTSxDQUFDLGlCQUFVLENBQUMsY0FBTSxPQUFBLElBQUksRUFBSixDQUFJLENBQUMsQ0FBQzs7Z0JBM0M5QztJQXFIRixlQUFDO0FBQUQsQ0FuSEEsQUFtSEMsSUFBQTtBQW5IWSxnQkFBUSxXQW1IcEIsQ0FBQTtBQU9EO0lBQUE7SUFDQSxDQUFDO0lBTkQ7UUFBQyxlQUFRLENBQUM7WUFDTixZQUFZLEVBQUUsQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLFVBQVUsQ0FBQztZQUMxQyxPQUFPLEVBQUUsQ0FBQyxxQkFBWSxDQUFDO1lBQ3ZCLE9BQU8sRUFBRSxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsVUFBVSxDQUFDO1NBQ3hDLENBQUM7O2tCQUFBO0lBRUYsaUJBQUM7QUFBRCxDQURBLEFBQ0MsSUFBQTtBQURZLGtCQUFVLGFBQ3RCLENBQUEiLCJmaWxlIjoibGlzdC9saXN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgQ29udGVudENoaWxkcmVuLCBRdWVyeUxpc3QsIFJlbmRlcmVyLCBOZ01vZHVsZSwgT25Jbml0LCBPbkRlc3Ryb3ksIFZpZXdDaGlsZCwgSW5qZWN0LCBmb3J3YXJkUmVmLCBFbGVtZW50UmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb21tb25Nb2R1bGUgfSBmcm9tIFwiQGFuZ3VsYXIvY29tbW9uXCI7XG5pbXBvcnQgeyBIYW1tZXJHZXN0dXJlc01hbmFnZXIgfSBmcm9tICcuLi9jb3JlL3RvdWNoJztcblxuZXhwb3J0IGludGVyZmFjZSBJTGlzdENoaWxkXG57XG4gICAgaW5kZXg6IG51bWJlcjtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PSBMSVNUID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBUaGUgYDxpZy1saXN0PmAgZGlyZWN0aXZlIGlzIGEgbGlzdCBjb250YWluZXIgZm9yIGl0ZW1zIGFuZCBoZWFkZXJzIFxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdpZy1saXN0JyxcbiAgICBtb2R1bGVJZDogbW9kdWxlLmlkLCAvLyBjb21tb25KUyBzdGFuZGFyZFxuICAgIHRlbXBsYXRlOiBgXG4gICAgICA8ZGl2ICN3cmFwcGVyIGNsYXNzPVwie3tfaW5uZXJTdHlsZX19XCIgW2hpZGRlbl09XCJoaWRkZW5cIj5cbiAgICAgICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuICAgICAgPC9kaXY+XG4gICAgICA8IS0tPGRpdiAqbmdJZj1cIm9wdGlvbnNcIiBjbGFzcz1cIm9wdGlvbnNcIj5cbiAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi1zdWNjZXNzXCI+IE9LIDwvYnV0dG9uPlxuICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJidG4gYnRuLWRhbmdlclwiPiBDYW5jZWwgPC9idXR0b24+XG4gICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4taW5mb1wiPiBNb3JlIGluZm8gPC9idXR0b24+XG4gICAgICA8L2Rpdj4tLT5cbiAgICBgXG59KVxuXG5leHBvcnQgY2xhc3MgTGlzdCB7IFxuICAgIHByaXZhdGUgX2lubmVyU3R5bGU6IHN0cmluZyA9IFwiaWctbGlzdFwiO1xuXG4gICAgY2hpbGRyZW46IElMaXN0Q2hpbGRbXSA9IFtdO1xuICAgIGdldCBpdGVtcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGRyZW4uZmlsdGVyKChpdGVtOiBJTGlzdENoaWxkKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gaXRlbSBpbnN0YW5jZW9mIExpc3RJdGVtO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXQgaGVhZGVycygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGRyZW4uZmlsdGVyKChoZWFkZXI6IElMaXN0Q2hpbGQpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBoZWFkZXIgaW5zdGFuY2VvZiBMaXN0SGVhZGVyO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnQ6IEVsZW1lbnRSZWYpIHsgICAgICAgIFxuICAgIH1cblxuICAgIHJlbW92ZUNoaWxkKGluZGV4OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIH1cblxuICAgIGFkZENoaWxkKGNoaWxkOiBJTGlzdENoaWxkKSB7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChjaGlsZCk7XG4gICAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09IEhFQURFUiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVGhlIGA8aWctaGVhZGVyPmAgZGlyZWN0aXZlIGlzIGEgaGVhZGVyIGludGVuZGVkIGZvciByb3cgaXRlbXMgaW5cbi8vIGEgYDxpZy1saXN0PmAgY29udGFpbmVyLlxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdpZy1saXN0LWhlYWRlcicsXG4gICAgbW9kdWxlSWQ6IG1vZHVsZS5pZCwgLy8gY29tbW9uSlMgc3RhbmRhcmRcbiAgICB0ZW1wbGF0ZTogYFxuICAgICAgPGRpdiAjd3JhcHBlciBjbGFzcz1cInt7X2lubmVyU3R5bGV9fVwiIFtoaWRkZW5dPVwiaGlkZGVuXCI+XG4gICAgICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cbiAgICAgIDwvZGl2PlxuICAgICAgPCEtLTxkaXYgKm5nSWY9XCJvcHRpb25zXCIgY2xhc3M9XCJvcHRpb25zXCI+XG4gICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tc3VjY2Vzc1wiPiBPSyA8L2J1dHRvbj5cbiAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi1kYW5nZXJcIj4gQ2FuY2VsIDwvYnV0dG9uPlxuICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJidG4gYnRuLWluZm9cIj4gTW9yZSBpbmZvIDwvYnV0dG9uPlxuICAgICAgPC9kaXY+LS0+XG4gICAgYFxufSlcblxuZXhwb3J0IGNsYXNzIExpc3RIZWFkZXIgaW1wbGVtZW50cyBPbkluaXQsIElMaXN0Q2hpbGQge1xuICAgIHByaXZhdGUgX2lubmVyU3R5bGU6IHN0cmluZyA9IFwiaWctbGlzdF9faGVhZGVyXCI7XG4gICAgZ2V0IGluZGV4KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLmxpc3QuY2hpbGRyZW4uaW5kZXhPZih0aGlzKTtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3RvciggQEluamVjdChmb3J3YXJkUmVmKCgpID0+IExpc3QpKSBwcml2YXRlIGxpc3Q6IExpc3QsIHB1YmxpYyBlbGVtZW50OiBFbGVtZW50UmVmKSB7IH1cblxuICAgIHB1YmxpYyBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5saXN0LmFkZENoaWxkKHRoaXMpO1xuICAgIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PSBJVEVNID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBUaGUgYDxpZy1pdGVtPmAgZGlyZWN0aXZlIGlzIGEgY29udGFpbmVyIGludGVuZGVkIGZvciByb3cgaXRlbXMgaW5cbi8vIGEgYDxpZy1saXN0PmAgY29udGFpbmVyLlxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdpZy1saXN0LWl0ZW0nLFxuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsIC8vIGNvbW1vbkpTIHN0YW5kYXJkXG4gICAgdGVtcGxhdGU6IGBcbiAgICAgIDxkaXYgI3dyYXBwZXIgY2xhc3M9XCJ7e19pbm5lclN0eWxlfX1cIiBbaGlkZGVuXT1cImhpZGRlblwiPlxuICAgICAgICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG4gICAgICA8L2Rpdj5cbiAgICAgIDwhLS08ZGl2ICpuZ0lmPVwib3B0aW9uc1wiIGNsYXNzPVwib3B0aW9uc1wiPlxuICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJidG4gYnRuLXN1Y2Nlc3NcIj4gT0sgPC9idXR0b24+XG4gICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tZGFuZ2VyXCI+IENhbmNlbCA8L2J1dHRvbj5cbiAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi1pbmZvXCI+IE1vcmUgaW5mbyA8L2J1dHRvbj5cbiAgICAgIDwvZGl2Pi0tPlxuICAgIGBcbn0pXG5cbmV4cG9ydCBjbGFzcyBMaXN0SXRlbSBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBJTGlzdENoaWxkIHtcbiAgICBAVmlld0NoaWxkKCd3cmFwcGVyJykgd3JhcHBlcjogRWxlbWVudFJlZjtcblxuICAgIHByaXZhdGUgX1ZJU0lCTEVfQVJFQV9PTl9GVUxMX1BBTiA9IDQwOyAvLyBpbiBwaXhlbHNcbiAgICBwcml2YXRlIF9GUkFDVElPTl9PRl9XSURUSF9UT19UUklHR0VSX0dSSVAgPSAwLjU7IC8vIGFzIGEgZnJhY3Rpb24gb2YgdGhlIGl0ZW0gd2lkdGhcbiAgICBwcml2YXRlIF9pbml0aWFsTGVmdDogbnVtYmVyID0gbnVsbDtcbiAgICBwcml2YXRlIF9pbm5lclN0eWxlOiBzdHJpbmcgPSBcImlnLWxpc3RfX2l0ZW1cIjtcblxuICAgIGhpZGRlbjogYm9vbGVhbiA9IGZhbHNlO1xuICAgIGdldCBpbmRleCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5saXN0LmNoaWxkcmVuLmluZGV4T2YodGhpcyk7XG4gICAgfVxuXG4gICAgZ2V0IHdpZHRoKCkge1xuICAgICAgICBpZiAodGhpcy5lbGVtZW50ICYmIHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBsZWZ0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy53cmFwcGVyLm5hdGl2ZUVsZW1lbnQub2Zmc2V0TGVmdDtcbiAgICB9XG4gICAgc2V0IGxlZnQodmFsdWU6IG51bWJlcikge1xuICAgICAgICB2YXIgdmFsID0gdmFsdWUgKyBcIlwiO1xuXG4gICAgICAgIGlmICh2YWwuaW5kZXhPZihcInB4XCIpID09IC0xKSB7XG4gICAgICAgICAgICB2YWwgKz0gXCJweFwiO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy53cmFwcGVyLm5hdGl2ZUVsZW1lbnQuc3R5bGUubGVmdCA9IHZhbDtcbiAgICB9XG5cbiAgICBnZXQgbWF4TGVmdCgpIHtcbiAgICAgICAgcmV0dXJuIC10aGlzLndpZHRoICsgdGhpcy5fVklTSUJMRV9BUkVBX09OX0ZVTExfUEFOO1xuICAgIH1cblxuICAgIEBJbnB1dCgpIGhyZWY6IHN0cmluZztcbiAgICBASW5wdXQoKSBvcHRpb25zOiBBcnJheTxPYmplY3Q+XG5cbiAgICBjb25zdHJ1Y3RvciggQEluamVjdChmb3J3YXJkUmVmKCgpID0+IExpc3QpKSBwcml2YXRlIGxpc3Q6IExpc3QsIHB1YmxpYyBlbGVtZW50OiBFbGVtZW50UmVmLCBwcml2YXRlIF9yZW5kZXJlcjogUmVuZGVyZXIpIHtcbiAgICAgICAgXG4gICAgfVxuXG4gICAgcHVibGljIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLmxpc3QuYWRkQ2hpbGQodGhpcyk7XG5cbiAgICAgICAgdGhpcy5fYWRkRXZlbnRMaXN0ZW5lcnMoKTsgICAgICAgIFxuXG4gICAgICAgIC8vIEZpeCBmb3IgZGVmYXVsdCB2YWx1ZSBvZiB0b3VjaC1hY3Rpb246IG5vbmUsIHNldCBieSBIYW1tZXIuanNcbiAgICAgICAgdGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc3R5bGUudG91Y2hBY3Rpb24gPSBcImluaGVyaXRcIjtcbiAgICB9XG5cbiAgICBwdWJsaWMgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMubGlzdC5yZW1vdmVDaGlsZCh0aGlzLmluZGV4KTsgICAgICAgIFxuICAgIH1cblxuICAgIHByaXZhdGUgX2FkZEV2ZW50TGlzdGVuZXJzKCkge1xuICAgICAgICAvLyBEbyBub3QgYXR0YWNoIHBhbiBldmVudHMgaWYgdGhlcmUgaXMgbm8gb3B0aW9ucyAtIG5vIG5lZWQgdG8gcGFuIHRoZSBpdGVtXG4gICAgICAgIGlmICh0aGlzLl9yZW5kZXJlciAmJiB0aGlzLm9wdGlvbnMpIHtcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyLmxpc3Rlbih0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCwgJ3BhbnN0YXJ0JywgKGV2ZW50KSA9PiB7IHRoaXMucGFuU3RhcnQoZXZlbnQpOyB9KTtcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyLmxpc3Rlbih0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCwgJ3Bhbm1vdmUnLCAoZXZlbnQpID0+IHsgdGhpcy5wYW5Nb3ZlKGV2ZW50KTsgfSk7XG4gICAgICAgICAgICB0aGlzLl9yZW5kZXJlci5saXN0ZW4odGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQsICdwYW5lbmQnLCAoZXZlbnQpID0+IHsgdGhpcy5wYW5FbmQoZXZlbnQpOyB9KTtcbiAgICAgICAgfSAgICAgICAgXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjYW5jZWxFdmVudChldjogSGFtbWVySW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGVmdCA+IDAgfHwgdGhpcy5faW5pdGlhbExlZnQgPT0gbnVsbDtcbiAgICB9XG5cbiAgICBwcml2YXRlIHBhblN0YXJ0KGV2OiBIYW1tZXJJbnB1dCkge1xuICAgICAgICB0aGlzLl9pbml0aWFsTGVmdCA9IHRoaXMubGVmdDtcbiAgICB9XG5cbiAgICBwcml2YXRlIHBhbk1vdmUoZXY6IEhhbW1lcklucHV0KSB7XG4gICAgICAgIHZhciBuZXdMZWZ0O1xuXG4gICAgICAgIGlmICh0aGlzLmNhbmNlbEV2ZW50KGV2KSlcbiAgICAgICAgeyByZXR1cm47IH1cblxuICAgICAgICBuZXdMZWZ0ID0gdGhpcy5faW5pdGlhbExlZnQgKyBldi5kZWx0YVg7XG4gICAgICAgIG5ld0xlZnQgPSBuZXdMZWZ0ID4gMCA/IDAgOiBuZXdMZWZ0IDwgdGhpcy5tYXhMZWZ0ID8gdGhpcy5tYXhMZWZ0IDogbmV3TGVmdDtcblxuICAgICAgICB0aGlzLmxlZnQgPSBuZXdMZWZ0O1xuICAgIH1cblxuICAgIHByaXZhdGUgcGFuRW5kKGV2OiBIYW1tZXJJbnB1dCkge1xuICAgICAgICBpZiAodGhpcy5sZWZ0ID4gMCkge1xuICAgICAgICAgICAgdGhpcy5yaWdodE1hZ25ldGljR3JpcCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5tYWduZXRpY0dyaXAoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2luaXRpYWxMZWZ0ID0gbnVsbDtcbiAgICB9XG5cbiAgICBwcml2YXRlIG1hZ25ldGljR3JpcCgpIHtcbiAgICAgICAgdmFyIGxlZnQgPSB0aGlzLmxlZnQsXG4gICAgICAgICAgICBwYXJ0aWFsV2lkdGggPSB0aGlzLndpZHRoICogdGhpcy5fRlJBQ1RJT05fT0ZfV0lEVEhfVE9fVFJJR0dFUl9HUklQO1xuXG4gICAgICAgIGlmIChwYXJ0aWFsV2lkdGggJiYgbGVmdCA8IDAgJiYgLWxlZnQgPiBwYXJ0aWFsV2lkdGgpIHtcbiAgICAgICAgICAgIHRoaXMubGVmdE1hZ25ldGljR3JpcCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yaWdodE1hZ25ldGljR3JpcCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByaWdodE1hZ25ldGljR3JpcCgpIHtcbiAgICAgICAgdGhpcy5sZWZ0ID0gMDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGxlZnRNYWduZXRpY0dyaXAoKSB7XG4gICAgICAgIHRoaXMubGVmdCA9IHRoaXMubWF4TGVmdDtcbiAgICB9XG59XG5cbkBOZ01vZHVsZSh7XG4gICAgZGVjbGFyYXRpb25zOiBbTGlzdCwgTGlzdEl0ZW0sIExpc3RIZWFkZXJdLFxuICAgIGltcG9ydHM6IFtDb21tb25Nb2R1bGVdLFxuICAgIGV4cG9ydHM6IFtMaXN0LCBMaXN0SXRlbSwgTGlzdEhlYWRlcl1cbn0pXG5leHBvcnQgY2xhc3MgTGlzdE1vZHVsZSB7XG59Il19
